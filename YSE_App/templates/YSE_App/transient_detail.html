{% extends 'YSE_App/base.html' %}

{% block content %}

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>
		{{transient.name}}<br/>
		<small><a href="{% url 'index' %}">Back</a></small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="{% url 'dashboard' %}"><i class="fa fa-dashboard"></i> Home</a></li>
		<li>{{transient.name}}</li>
	</ol>
</section>

<!-- Main content -->
<section class="content">
	<!-- Default box -->
	<div class="box">
		<div class="box-header with-border">
			<h3 class="box-title">Detail</h3>
		</div>
		<div class="box-body">
			<div class="row invoice-info">
				<div class="col-sm-5 invoice-col">
					<b>RA/DEC (2000)</b><br>
					{{ transient.CoordString.0 }} {{ transient.CoordString.1 }}<br>
					{{ transient.ra }} {{ transient.dec }}<br>
					<br>
					<b>Best Spec. Class</b><br>
					{{transient.best_spec_class}}<br>
					<b>Most Recent Mag/Date/Filter</b><br>
					{{ recent_mag }}<br>
					{{recent_magdate}}<br>
					{{ recent_filter }}<br>
					<b>Disc Mag/Date/Filter</b><br>
					{{ first_mag }}<br>
					{{ first_magdate }}<br>
					{{ first_filter }}<br>
					<b>Status</b><br>
					{{ transient.status }}<br>
					<br>
					<b>Most Likely Host Galaxy</b><br>
					<table id="host_galaxy_tbl" class="table table-bordered table-hover">
					  <thead>
					    <tr>
					      <th>Name</th>
					      <th>Coords</th>
					      <th>Redshift</th>
					      <th>Mag</th>
					      <th>Separation (arcsec)</th>
					    </tr>
					  </thead>
					  <tbody>
					    <tr>
					      <td>{{ transient.hostdata.name }}</td>
					      <td>{{ transient.hostdata.CoordString.0 }} {{ transient.hostdata.CoordString.1 }}</td>
					      <td>{{ transient.hostdata.redshift }}</td>
					      <td>{{ transient.hostphotdata.mag }}</td>
					      <td>{{ transient.Separation }}</td>
                                            </tr>
					  </tbody>
					</table>
					
					<b>External Resources</b><br>
					<b><a href="https://wis-tns.weizmann.ac.il/object/{{ transient.name }}">TNS</a></b>
					<a target="_blank" href="http://nedwww.ipac.caltech.edu/cgi-bin/nph-objsearch?ra={{ transient.ra }}&dec={{ transient.dec }}d&radius=10.0&search_type=Near+Position+Search">NED</a>
					<a href="http://simbad.u-strasbg.fr/simbad/sim-coo?protocol=html&amp;NbIdent=1&amp;Radius=1&amp;Radius.unit=arcmin&amp;CooFrame=FK5&amp;CooEpoch=2000&amp;CooEqui=2000&amp;Coord={{ transient.ra }}+{{ transient.dec }}" target="_blank">SIMBAD</a>
					<a target="_blank" href="http://vizier.u-strasbg.fr/viz-bin/VizieR?-source=&-out.add=_r&-out.add=_RAJ%2C_DEJ&-sort=_r&-to=&-out.max=20&-meta.ucd=2&-meta.foot=1&-c={{ transient.ra }}+{{ transient.dec }}&-c.rs=10">VizieR</a>
					<a target="_blank" href="http://irsa.ipac.caltech.edu/applications/wise/#id=Hydra_wise_wise_1&RequestClass=ServerRequest&DoSearch=true&intersect=CENTER&subsize=0.16666666800000002&mcenter=all&schema=allsky-4band&dpLevel=3a&band=1,2,3,4&UserTargetWorldPt={{ transient.ra }};{{ transient.dec }};EQ_J2000&SimpleTargetPanel.field.resolvedBy=nedthensimbad&preliminary_data=no&coaddId=&projectId=wise&searchName=wise_1&shortDesc=Position&isBookmarkAble=true&isDrillDownRoot=true&isSearchResult=true">WISE</a>
					<a target="_blank" title="Download DSS image" href="http://archive.stsci.edu/cgi-bin/dss_search?h=5.0&w=5.0&f=fits&v=poss2ukstu_red&r={{ transient.ra }}d&d=+{{ transient.dec }}2d&e=J2000&c=none">DSS</a>
					<a target="_blank" title="ADS (10'') position search" href="http://adsabs.harvard.edu/cgi-bin/nph-abs_connect?db_key=AST&db_key=PRE&qform=AST&arxiv_sel=astro-ph&arxiv_sel=cond-mat&arxiv_sel=cs&arxiv_sel=gr-qc&arxiv_sel=hep-ex&arxiv_sel=hep-lat&arxiv_sel=hep-ph&arxiv_sel=hep-th&arxiv_sel=math&arxiv_sel=math-ph&arxiv_sel=nlin&arxiv_sel=nucl-ex&arxiv_sel=nucl-th&arxiv_sel=physics&arxiv_sel=quant-ph&arxiv_sel=q-bio&sim_query=YES&ned_query=YES&adsobj_query=YES&obj_req=YES&aut_logic=OR&obj_logic=OR&author=&object={{ transient.ra }}%20+{{ transient.dec }}%3A0.002778%0D%0A{{ transient.name }}&start_mon=&start_year=&end_mon=&end_year=&ttl_logic=OR&title=&txt_logic=OR&text=&nr_to_return=200&start_nr=1&jou_pick=ALL&ref_stems=&data_and=ALL&group_and=ALL&start_entry_day=&start_entry_mon=&start_entry_year=&end_entry_day=&end_entry_mon=&end_entry_year=&min_score=&sort=SCORE&data_type=SHORT&aut_syn=YES&ttl_syn=YES&txt_syn=YES&aut_wt=1.0&obj_wt=1.0&ttl_wt=0.3&txt_wt=3.0&aut_wgt=YES&obj_wgt=YES&ttl_wgt=YES&txt_wgt=YES&ttl_sco=YES&txt_sco=YES&version=1">ADS</a>
				</div>
				<!-- /.col -->
				<div class="col-sm-4 invoice-col">
					<b>SDSS Footprint<b><br>
						<a href="http://skyserver.sdss3.org/public/en/tools/chart/navi.aspx?opt=G&amp;ra={{ transient.ra }}&amp;dec={{ transient.dec }}&amp;scale=0.1981" target="_blank" title="Link to SDSS Navigate Tool" class="sdss-image-link">
							<img src="http://skyservice.pha.jhu.edu/DR14/ImgCutout/getjpeg.aspx?ra={{ transient.ra }}&dec={{ transient.dec }}&scale=0.5&width=200&height=200&opt=G&query=&Grid=on " style='width:240px' border="0">
						</a>
						<br>
						{% if jpegurl %}
						<b>Pan-STARRS Footprint</b><br>
						<a href="http://ps1images.stsci.edu/cgi-bin/ps1cutouts?pos={{ transient.ra }}%2B{{ transient.dec }}&amp;filter=color" class="ps1-thumb" title="Link to PanSTARRS-1" target="_blank">
						  <img src="{{ jpegurl }}" style='width:240px' alt="" /></a><br>
						{% else %}
						<b>Coordinates are outside the PS1 footprint</b><br>
						{% endif %}
				</div>
				<!-- /.col -->
			</div>
			<br>
						<div class="col-xs-12"> <!-- col-md-9 -->
							<div class="nav-tabs-custom">
								<ul class="nav nav-tabs">
									<li class="active"><a href="#followup" data-toggle="tab">Follow-up</a></li>
									<li><a href="#photometry" data-toggle="tab">Photometry</a></li>
									<li><a href="#spectra" data-toggle="tab">Spectra</a></li>
								</ul>

								<div class="tab-content">
									<div class="active tab-pane" id="followup">
									  <div class="box">
									    <p><a href="{% url 'admin:YSE_App_transientfollowup_add'  %}">Add Followup</a></p>
									    <p><a href="{% url 'admin:YSE_App_transient_change' transient.id %}">Change Transient Status</a></p>
									    <b><a href="https://docs.google.com/document/d/1VtMY2v7hssj6DF4Jn--skd1VfAHYCBWvptm3vkqFA8o/edit?usp=sharing" target="_blank">Follow-up Guidelines</a></b><br>
									    <b>Current time UT {{ nowtime }}</a></b><br>


                                                                            <b>Followup Tasks</b><br>
									    {% for f in followups %}
									    <!--<div class="box-header">
									      <h3 class="box-title">{{ f.name }} Tasks</h3>
									    </div>
									    <!-- /.box-header -->
									    <div class="box-body">
									      <table id="transient_tbl" class="table table-bordered table-hover">
										<thead>
										  <tr>
										    <th>Observation<br>Window</th>
										    <th>Observatory</th>
										    <th>Telescope</th>
										    <th>Instrument</th>
										    <th>Exposure<br>Time</th>
										    <th>Number of<br>Exposures</th>
										    <th>Configuration</th>
										    <th>Configuration<br>Detail</th>
										    <th>Status</th>
										    <th>Action</th>
										  </tr>
										</thead>
										<tbody>
										  {% for o in f.observationtask_set.all %}
										  <tr>
										    <td>{{ o.obs_window_start|date:"SHORT_DATE_FORMAT" }} &mdash;<br>{{ o.obs_window_stop|date:"SHORT_DATE_FORMAT" }}</td>
										    <td>{{ o.instrument_config.instrument.telescope.observatory.name }}</td>
										    <td>{{ o.instrument_config.instrument.telescope.name }}</td>
										    <td>{{ o.instrument_config.instrument.name }}</td>
										    <td>{{ o.exposure_time }}</td>
										    <td>{{ o.number_of_exposures }}</td>
										    <td>{{ o.instrument_config.name }}</td>
										    <td>
										      <ul>
											{% for c in o.instrument_config.configelement_set.all %}
											<li>{{ c.name }}</li>
											{% endfor %}
										      </ul>
										    </td>
										    <td>{{ o.status }}</td>
										    <td><a href="#">Edit</a></td>
										  </tr>
										  {% endfor %}
										  {% endfor %}
										</tbody>
									      </table>
									    </div>

									    <b>Classical Resources</b><br>
									    <table id="telescope_tbl" class="table table-bordered table-hover">
									      <thead>
										<tr>
										  <th>Telescope (Classical)</th>
										  <th>Next Obs. Night</th>
										  <th>Rise Time (UT)</th>
										  <th>Set Time (UT)</th>
										  <th>Moon Angle</th>
										  <th>Airmass Plot</th>
										</tr>
									      </thead>
									      <tbody>
										{% for telescope in telescope_list %}
										{% for obsnight in observing_nights %}
										{% if obsnight.0.happening_soon and obsnight.0.telescope == telescope.tostring and obsnight.1 %}

										<tr>
										  <td>{{ telescope }}</td>
                                                                                  <td>{{ obsnight.0.obs_date }}</td>
										  <td>{{ obsnight.0.rise_time }}</td>
                                                                                  <td>{{ obsnight.0.set_time }}</td>
                                                                                  <td>{{ obsnight.0.moon_angle }} deg</td>
                                         	        			  <td><img src="{% url 'airmassplot' transient.id obsnight.0.id telescope.id %}" style='width:240px' alt="" /><br></td>
										</tr>
										{% endif %}
										{% endfor %}
										{% endfor %}

                                     					  </tbody>
				                                	</table>
									    <b>ToO Resources</b><br>
									    <table id="telescope_tbl" class="table table-bordered table-hover">
									      <thead>
										<tr>
										  <th>Telescope (ToO)</th>
										  <th>ToO Hours Remaining</th>
										  <th>Rise Time (UT)</th>
										  <th>Set Time (UT)</th>
										  <th>Moon Angle</th>
										  <th>Airmass Plot</th>
										</tr>
									      </thead>
									      <tbody>
										{% for too_resource in too_resource_list %}
										{% if too_resource.deltahours > 0 %}
										<tr>
										  <td>{{ too_resource.telescope }}</td>
										  <td>{{ too_resource.deltahours }}</td>
                                                                                  <td>{{ too_resource.rise_time }}</td>
                                                                                  <td>{{ too_resource.set_time }}</td>
                                                                                  <td>{{ too_resource.moon_angle }} deg</td>
                                         	        			  <td><img src="{% url 'airmassplot' transient.id 0 too_resource.telescope_id %}" style='width:240px' alt="" /><br></td>
										</tr>
										{% endif %}
										{% endfor %}

                                     					  </tbody>
				                                	</table>

									    
									    <!-- /.box-body -->
									  </div>
									  
						<!-- <table id="transient_tbl" class="table table-bordered table-hover">
						<thead>
						<tr>
							<th>Obs Date</th>
							<th>Observatory</th>
							<th>Telescope</th>
							<th>Instrument</th>
							<th>Exposure Time</th>
							<th>Number of Exp.</th>
							<th>Configuration</th>
							<th>Configuration Detail</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
						</thead>
						<tbody>
						{% for o in obs_list %}
							<tr>
							<td>{{ o.obs_window_start|date:"SHORT_DATE_FORMAT" }}</td>
							<td>{{ o.instrument_config.instrument.telescope.observatory.name }}</td>
							<td>{{ o.instrument_config.instrument.telescope.name }}</td>
							<td>{{ o.instrument_config.instrument.name }}</td>
							<td>{{ o.exposure_time }}</td>
							<td>{{ o.number_of_exposures }}</td>
							<td>{{ o.instrument_config.name }}</td>
							<td>
								<ul>
								{% for c in o.instrument_config.configelement_set.all %}
									<li>{{ c.name }}</li>
								{% endfor %}
								</ul>
							</td>
							<td>{{ o.status }}</td>
							<td><a href="#">Edit</a></td>
							</tr>
						{% endfor %}
						<tr>
							<td colspan="9" />
							<td><a href="#">Add</a></td>
						</tr>
						</tbody>
					</table> -->


				<!-- 
			      </div>
			      <!-- /.tab-pane -->
			      <div class="tab-pane" id="photometry">
			        <h4>Photometry for {{transient.name}}</h4>
			      </div>
			      <!-- /.tab-pane -->

			<div class="tab-pane" id="spectra">
				<h4>Spectra for {{transient.name}}</h4>
			</div>
			<!-- /.tab-pane -->
		</div>
		<!-- /.tab-content -->
	</div>
	<!-- /.nav-tabs-custom -->
</div>
</div>
<!-- /.box-body -->
<div class="box-footer">
</div>
<!-- /.box-footer-->
</div>
<!-- /.box -->

</section>

{% endblock %}
